version: "v1.0"
name: Python Example
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804

blocks:
  - name: Tests
    task:
      prologue:
        commands:
          - export PATH=$HOME/.local/bin:$PATH
          - checkout
          - mkdir .pip_cache
          - cache restore v3-pip-$(checksum requirements.txt)
          - pip install --user --cache-dir .pip_cache -r requirements.txt
          - cache store v3-pip-$(checksum requirements.txt) .pip_cache
      jobs:
        - name: Everything
          commands:
            - py.test
